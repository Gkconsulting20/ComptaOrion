function ParametresTab() {
  const [clients, setClients] = useState([]);
  const [comptesComptables, setComptesComptables] = useState([]);
  const [loading, setLoading] = useState(true);
  const [selectedClient, setSelectedClient] = useState(null);
  const [showModal, setShowModal] = useState(false);
  const [selectedCompteId, setSelectedCompteId] = useState(null);

  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    try {
      const [clientsRes, comptesRes] = await Promise.all([
        api.get('/clients'),
        api.get('/comptabilite/comptes')
      ]);
      setClients(clientsRes.data || []);
      setComptesComptables(comptesRes.data || []);
    } catch (error) {
      console.error('Erreur:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleConfigureCompte = (client) => {
    setSelectedClient(client);
    setSelectedCompteId(client.compteComptableId || null);
    setShowModal(true);
  };

  const handleSaveCompte = async () => {
    try {
      await api.put(`/clients/${selectedClient.id}`, {
        ...selectedClient,
        compteComptableId: selectedCompteId
      });
      loadData();
      setShowModal(false);
      setSelectedClient(null);
      alert('Compte comptable configurÃ© avec succÃ¨s!');
    } catch (error) {
      alert('Erreur: ' + error.message);
    }
  };

  const columns = [
    { key: 'numeroClient', label: 'NÂ° Client' },
    { key: 'nom', label: 'Nom' },
    { key: 'type', label: 'Type' },
    { 
      key: 'compteComptableId', 
      label: 'Compte Comptable',
      render: (val) => {
        if (!val) return <span style={{ color: '#e74c3c', fontStyle: 'italic' }}>Non configurÃ©</span>;
        const compte = comptesComptables.find(c => c.id === val);
        return compte ? `${compte.numero} - ${compte.nom}` : 'N/A';
      }
    },
  ];

  if (loading) return <p>Chargement...</p>;

  return (
    <div>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
        <h3>âš™ï¸ ParamÃ¨tres Comptables des Clients</h3>
      </div>

      <div style={{ 
        padding: '15px', 
        backgroundColor: '#d1ecf1', 
        borderRadius: '8px',
        marginBottom: '20px',
        border: '1px solid #bee5eb'
      }}>
        <p style={{ margin: 0, color: '#0c5460', fontSize: '14px' }}>
          ğŸ’¡ <strong>Configuration des comptes comptables:</strong> Associez un compte comptable Ã  chaque client pour automatiser les Ã©critures comptables lors de la facturation.
        </p>
      </div>

      <Table 
        columns={columns} 
        data={clients} 
        actions={true}
        customActions={(client) => (
          <Button size="small" variant="info" onClick={() => handleConfigureCompte(client)}>
            âš™ï¸ Configurer
          </Button>
        )}
      />

      {/* MODAL CONFIGURATION COMPTE COMPTABLE */}
      <Modal
        isOpen={showModal}
        onClose={() => { setShowModal(false); setSelectedClient(null); }}
        title={`âš™ï¸ Configuration Compte Comptable - ${selectedClient?.nom}`}
        size="medium"
      >
        <div style={{ marginBottom: '20px' }}>
          <div style={{ 
            padding: '15px', 
            backgroundColor: '#f8f9fa', 
            borderRadius: '8px',
            marginBottom: '20px'
          }}>
            <div style={{ fontSize: '14px', marginBottom: '5px', color: '#666' }}>Client</div>
            <div style={{ fontSize: '18px', fontWeight: 'bold' }}>{selectedClient?.nom}</div>
            <div style={{ fontSize: '14px', color: '#666', marginTop: '5px' }}>
              NÂ° Client: {selectedClient?.numeroClient || 'N/A'}
            </div>
          </div>

          <FormField
            label="Compte Comptable (SYSCOHADA/IFRS/PCG)"
            type="select"
            value={selectedCompteId || ''}
            onChange={(e) => setSelectedCompteId(parseInt(e.target.value) || null)}
            options={[
              { value: '', label: '-- SÃ©lectionner un compte --' },
              ...comptesComptables
                .filter(c => c.actif)
                .map(c => ({
                  value: c.id,
                  label: `${c.numero} - ${c.nom} (${c.type})`
                }))
            ]}
          />

          <div style={{ 
            padding: '15px', 
            backgroundColor: '#fff3cd', 
            borderRadius: '8px',
            marginTop: '15px',
            border: '1px solid #ffc107'
          }}>
            <div style={{ fontSize: '12px', color: '#856404' }}>
              ğŸ’¡ <strong>Conseil:</strong> Pour les clients, utilisez gÃ©nÃ©ralement un compte de classe 4 (Comptes de tiers) comme:
            </div>
            <ul style={{ fontSize: '12px', color: '#856404', marginTop: '10px', marginBottom: 0 }}>
              <li>411 - Clients</li>
              <li>4111 - Clients ordinaires</li>
              <li>4117 - CrÃ©ances douteuses</li>
            </ul>
          </div>
        </div>

        <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end' }}>
          <Button variant="secondary" onClick={() => { setShowModal(false); setSelectedClient(null); }}>
            Annuler
          </Button>
          <Button variant="success" onClick={handleSaveCompte}>
            ğŸ’¾ Enregistrer
          </Button>
        </div>
      </Modal>
    </div>
  );
}
